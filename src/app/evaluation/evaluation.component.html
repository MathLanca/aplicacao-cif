<div *ngIf="loading" class="spinner" fxLayoutAlign="center">
    <mat-spinner></mat-spinner>
</div>

<mat-horizontal-stepper *ngIf="!loading" class="main-stepper" linear="false" #stepper>
    <mat-step fxLayoutAlign="center" [stepControl]="firstFormGroup">
        <form [formGroup]="firstFormGroup">
            <ng-template matStepLabel>
                <span matTooltip="{{stepOne}}">{{stepOne}}</span>
            </ng-template>

            <h3 matTooltip="{{stepOne}}">{{stepOne}}</h3>

            <mat-card>
                <mat-form-field>
                    <mat-label>Paciente</mat-label>
                    <mat-select formControlName="cpf">
                        <mat-option *ngFor="let patient of patients" [value]="patient.id">
                            {{ patient.firstName }} - {{ patient.cpf | mask: '000.000.000-00' }}
                        </mat-option>
                    </mat-select>
                    <!-- <input mask="000.000.000-00" maxlength="14" matTooltip="CPF sem pontuação" matTooltipPosition="after" matInput placeholder="CPF" #cpf formControlName="cpf" required> -->
                </mat-form-field>
                <mat-form-field>
                    <mat-label>Local da Avaliação</mat-label>
                    <input (change)="searchLocal($event)" matInput placeholder="Local da Avaliação" formControlName="evaluationLocal" required>
                </mat-form-field>
                <div>
                    <button mat-button matStepperNext>Next</button>
                </div>
            </mat-card>
        </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
            <ng-template matStepLabel>
                <span matTooltip="{{stepTwo}}">{{stepTwo}}</span>
            </ng-template>

            <mat-card class="session-description">
                <mat-card-title>
                    <p>{{stepTwo}}
                    </p>
                </mat-card-title>
                <mat-card-subtitle>
                    <p>Constituem o ambiente físico, social e de atitudes em que as pessoas vivem e conduzem sua vida.</p>
                    <p class="bold-font">Quanto estes fatores são facilitadores e/ou barreiras na sua vida... </p>
                    <p>Você também pode classificar os fatores ambientais como um facilitador e uma barreira, se aplicável.</p>
                </mat-card-subtitle>
            </mat-card>

            <mat-accordion>
                <mat-expansion-panel #factorPanel *ngFor="let factor of environmentalFactors">
                    <mat-expansion-panel-header *ngIf="!factorPanel.expanded">
                        <mat-panel-title *ngIf="!factorPanel.expanded">
                            {{ factor.code}}
                        </mat-panel-title>
                        <mat-panel-description *ngIf="!factorPanel.expanded">
                            {{factor.title }}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <p>{{ factor.code }} - <span class="inner-title">{{ factor.title }}</span></p>

                    <mat-divider></mat-divider>

                    <p class="bold-font">{{ factor.description }}</p>
                    <p *ngIf="factor.inclusion != null"><span class="bold-font">Inclusões: </span>{{ factor.inclusion }}</p>
                    <p *ngIf="factor.exclusion != null"><span class="bold-font">Exclusões: </span>{{ factor.exclusion }}</p>

                    <mat-divider></mat-divider>

                    <div fxLayoutAlign="end" class="general-grade">
                        <span class="bold-font grade">Geral</span>
                        <mat-radio-group class="grade-radio" aria-label="Select an option">
                            <mat-radio-button color="warn" value="0">0</mat-radio-button>
                            <mat-radio-button color="warn" value="0.5">+1</mat-radio-button>
                            <mat-radio-button color="warn" value="1">1</mat-radio-button>
                            <mat-radio-button color="warn" value="1.5">+2</mat-radio-button>
                            <mat-radio-button color="warn" value="2">2</mat-radio-button>
                            <mat-radio-button color="warn" value="3">3</mat-radio-button>
                            <mat-radio-button color="warn" value="3.5">+3</mat-radio-button>
                            <mat-radio-button color="warn" value="4">+4</mat-radio-button>
                            <mat-radio-button color="warn" value="4.5">4</mat-radio-button>
                            <mat-radio-button color="warn" value="8">8</mat-radio-button>
                            <mat-radio-button color="warn" value="9">9</mat-radio-button>
                        </mat-radio-group>

                        <mat-select class="grade-select">
                            <mat-option value="0">0</mat-option>
                            <mat-option value="0.5">+1</mat-option>
                            <mat-option value="1">1</mat-option>
                            <mat-option value="1.5">+2</mat-option>
                            <mat-option value="2">2</mat-option>
                            <mat-option value="3">3</mat-option>
                            <mat-option value="3.5">+3</mat-option>
                            <mat-option value="4">+4</mat-option>
                            <mat-option value="4.5">4</mat-option>
                            <mat-option value="8">8</mat-option>
                            <mat-option value="9">9</mat-option>
                        </mat-select>
                    </div>




                </mat-expansion-panel>
            </mat-accordion>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
            <ng-template matStepLabel>
                <span matTooltip="{{stepThree}}">{{stepThree}}</span>
            </ng-template>

            <mat-card class="session-description">
                <mat-card-title>
                    <p>{{stepThree}}
                    </p>
                </mat-card-title>
                <mat-card-subtitle>
                    <p>Execução de uma tarefa ou ação por um indivíduo e envolvimento e envolvimento numa situação da vital</p>
                    <p class="bold-font">Quanto prejuízo a pessoa tem em ...</p>
                    <p>P = DESEMPENHO EM ...</p>
                    <p>C = CAPACIDADE DE ...</p>
                </mat-card-subtitle>
            </mat-card>

            <mat-accordion>
                <mat-expansion-panel #aNpPanel *ngFor="let aNp of activityAndParticipation">
                    <mat-expansion-panel-header *ngIf="!aNpPanel.expanded">
                        <mat-panel-title *ngIf="!aNpPanel.expanded">
                            {{ aNp.code}}
                        </mat-panel-title>
                        <mat-panel-description *ngIf="!aNpPanel.expanded">
                            {{aNp.title }}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <p>{{ aNp.code }} - <span class="inner-title">{{ aNp.title }}</span></p>
                </mat-expansion-panel>
            </mat-accordion>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
            <ng-template matStepLabel>
                <span matTooltip="{{stepFour}}">{{stepFour}}</span>
            </ng-template>

            <mat-card class="session-description">
                <mat-card-title>
                    <p>{{stepFour}}
                    </p>
                </mat-card-title>
                <mat-card-subtitle>
                    <p>As estruturas do corpo são partes anatômicas do corpo, como, orgãos, membros e seus componentes</p>
                    <p class="bold-font">Quanto prejuízo a pessoa tem em ...</p>
                </mat-card-subtitle>
            </mat-card>

            <mat-accordion>
                <mat-expansion-panel #structurePanel *ngFor="let structure of bodyStructures">
                    <mat-expansion-panel-header *ngIf="!structurePanel.expanded">
                        <mat-panel-title *ngIf="!structurePanel.expanded">
                            {{ structure.code}}
                        </mat-panel-title>
                        <mat-panel-description *ngIf="!structurePanel.expanded">
                            {{structure.title }}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <p>{{ structure.code }} - <span class="inner-title">{{ structure.title }}</span></p>
                </mat-expansion-panel>
            </mat-accordion>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
            <ng-template matStepLabel>
                <span matTooltip="{{stepFive}}">{{stepFive}}</span>
            </ng-template>

            <mat-card class="session-description">
                <mat-card-title>
                    <p>{{stepFive}}
                    </p>
                </mat-card-title>
                <mat-card-subtitle>
                    <p>Funções fisiológicas dos sistema corporais (incluindo as funções psicológicas)</p>
                    <p class="bold-font">Quanto prejuízo a pessoa tem em ...</p>
                </mat-card-subtitle>
            </mat-card>

            <mat-accordion>
                <mat-expansion-panel #functionPanel *ngFor="let function of bodyFunctions">
                    <mat-expansion-panel-header *ngIf="!functionPanel.expanded">
                        <mat-panel-title *ngIf="!functionPanel.expanded">
                            {{ function.code }}
                        </mat-panel-title>
                        <mat-panel-description *ngIf="!functionPanel.expanded">
                            {{ function.title }}
                        </mat-panel-description>
                    </mat-expansion-panel-header>

                    <p>{{ function.code }} - <span class="inner-title">{{ function.title }}</span></p>
                </mat-expansion-panel>
            </mat-accordion>
            <div>
                <button mat-button matStepperPrevious>Back</button>
                <button mat-button matStepperNext>Next</button>
            </div>
        </form>
    </mat-step>
    <mat-step>
        <ng-template matStepLabel>Done</ng-template>
        <p>You are now done.</p>
        <div>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
    </mat-step>
</mat-horizontal-stepper>